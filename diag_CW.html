<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>PC & Netwerk Diagnose</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --card: #020617;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #38bdf8;
      --error: #f97373;
      --border: rgba(148,163,184,0.4);
      --radius: 14px;
      --shadow: 0 18px 40px rgba(15,23,42,0.8);
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      background: radial-gradient(circle at top, #1f2937 0, #020617 60%, #020617 100%);
      color: var(--text);
    }

    .app {
      width: 100%;
      max-width: 900px;
      background: linear-gradient(135deg, rgba(15,23,42,0.98), rgba(15,23,42,0.98));
      border-radius: 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 18px 20px 16px;
    }

    h1 {
      margin: 0 0 4px;
      font-size: 22px;
      letter-spacing: 0.03em;
    }

    .subtitle {
      margin: 0 0 16px;
      font-size: 13px;
      color: var(--muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 11px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.14em;
      margin-bottom: 6px;
    }

    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 8px rgba(34,197,94,0.9);
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1fr) minmax(0, 1fr);
      gap: 14px;
    }

    .card {
      background: radial-gradient(circle at 0 0, rgba(15,23,42,1), #020617);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      padding: 12px 14px;
      font-size: 13px;
    }

    .card h2 {
      margin: 0 0 8px;
      font-size: 15px;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .kv-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      padding: 3px 0;
      border-bottom: 1px dashed rgba(148,163,184,0.3);
    }

    .kv-row:last-child {
      border-bottom: none;
    }

    .kv-key { color: var(--muted); font-size: 12px; }
    .kv-value {
      font-family: ui-monospace, monospace;
      font-size: 12px;
      text-align: right;
    }

    .btn-row {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    button {
      border-radius: 999px;
      border: 1px solid rgba(56,189,248,0.8);
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.28), #020617);
      color: #e0f2fe;
      font-size: 13px;
      padding: 7px 14px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 0 0 1px rgba(56,189,248,0.35);
    }

    button:hover {
      box-shadow: 0 0 0 1px rgba(56,189,248,0.8);
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.4), #020617);
    }

    button:active {
      transform: translateY(1px);
    }

    .status {
      font-size: 12px;
      color: var(--muted);
    }

    .error { color: var(--error); }
    .results { margin-top: 4px; }

    .small {
      font-size: 11px;
      color: var(--muted);
      margin-top: 8px;
    }

    @media (max-width: 720px) {
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="badge">
      <span class="badge-dot"></span>
      Snelle check Â· Browser & netwerk
    </div>
    <h1>PC & Netwerk Diagnose</h1>
    <p class="subtitle">
      Laat de pagina volledig laden en klik daarna op de testknoppen. Stuur eventueel een screenshot door.
    </p>

    <div class="grid">
      <!-- SYSTEEM -->
      <section class="card">
        <h2>Systeem</h2>
        <div class="kv-row"><span class="kv-key">Besturingssysteem</span><span class="kv-value" id="osInfo">â€“</span></div>
        <div class="kv-row"><span class="kv-key">Browser</span><span class="kv-value" id="browserInfo">â€“</span></div>
        <div class="kv-row"><span class="kv-key">Taal</span><span class="kv-value" id="langInfo">â€“</span></div>
        <div class="kv-row"><span class="kv-key">CPU cores</span><span class="kv-value" id="cpuInfo">â€“</span></div>
        <div class="kv-row"><span class="kv-key">Geheugen</span><span class="kv-value" id="ramInfo">â€“</span></div>
        <div class="kv-row"><span class="kv-key">Scherm</span><span class="kv-value" id="screenInfo">â€“</span></div>

        <div class="btn-row">
          <button id="cpuTestBtn" type="button">ðŸ§® CPU-test</button>
        </div>
        <div class="results" id="cpuResult"></div>
      </section>

      <!-- NETWERK -->
      <section class="card">
        <h2>Netwerk</h2>
        <div class="kv-row"><span class="kv-key">Status</span><span class="kv-value" id="onlineInfo">â€“</span></div>
        <div class="kv-row"><span class="kv-key">Type</span><span class="kv-value" id="connType">â€“</span></div>
        <div class="kv-row"><span class="kv-key">Downlink</span><span class="kv-value" id="connDownlink">â€“</span></div>
        <div class="kv-row"><span class="kv-key">RTT</span><span class="kv-value" id="connRtt">â€“</span></div>

        <div class="btn-row">
          <button id="netTestBtn" type="button">ðŸ“¡ Snelheidstest</button>
        </div>
        <div class="status" id="netStatus">Nog geen test uitgevoerd.</div>
        <div class="results" id="netResult"></div>
      </section>
    </div>

    <!-- VERZENDKNOP -->
    <div class="btn-row" style="margin-top: 16px;">
      <button id="sendBtn" type="button">ðŸ“¤ Verstuur resultaten naar CW</button>
      <span id="sendStatus" class="status"></span>
    </div>

    <p class="small">
      Deze resultaten zijn indicatief en afhankelijk van de browser en verbinding.
    </p>
  </div>

  <script>
    // ==== CONFIG ====
    const TEST_FILE_URL = "assets/speedtest.bin";        // 1 MB testbestand
    const TEST_FILE_SIZE_BYTES = 1048576;                // 1 MB

    // URL van je Apps Script Web App (eindigt op /exec)
    const SHEET_API_URL = "https://script.google.com/a/macros/contactworx.nl/s/AKfycbwpOAqZcWSGXMMjctGWdpiioCE8AFFe-ubGopyDLDgPFrpSbl7j-maa2qNDCA3EIRyR/exec";

    // ==== SYSTEEMINFO ====
    function getPrettyBrowser() {
      const ua = navigator.userAgent || "";
      if (ua.includes("Edg")) return "Microsoft Edge";
      if (ua.includes("Chrome")) return "Google Chrome";
      if (ua.includes("Firefox")) return "Mozilla Firefox";
      if (ua.includes("Safari")) return "Safari";
      return "Onbekend";
    }

    function initSystemInfo() {
      document.getElementById("browserInfo").textContent = getPrettyBrowser();
      document.getElementById("osInfo").textContent = navigator.platform || "Onbekend";
      document.getElementById("langInfo").textContent = navigator.language || "Onbekend";

      document.getElementById("cpuInfo").textContent =
        navigator.hardwareConcurrency
          ? navigator.hardwareConcurrency + " cores"
          : "Niet beschikbaar";

      document.getElementById("ramInfo").textContent =
        navigator.deviceMemory
          ? navigator.deviceMemory + " GB (browser-schatting)"
          : "Niet beschikbaar";

      document.getElementById("screenInfo").textContent =
        (screen.width && screen.height) ? `${screen.width} Ã— ${screen.height}` : "Onbekend";

      document.getElementById("onlineInfo").textContent =
        navigator.onLine ? "Online" : "Offline";

      const conn = navigator.connection || navigator.webkitConnection || navigator.mozConnection;
      if (conn) {
        document.getElementById("connType").textContent = conn.effectiveType || conn.type || "Niet beschikbaar";
        document.getElementById("connDownlink").textContent =
          conn.downlink ? conn.downlink + " Mbit/s (schatting)" : "Niet beschikbaar";
        document.getElementById("connRtt").textContent =
          conn.rtt ? conn.rtt + " ms (schatting)" : "Niet beschikbaar";
      } else {
        document.getElementById("connType").textContent = "Niet beschikbaar";
        document.getElementById("connDownlink").textContent = "Niet beschikbaar";
        document.getElementById("connRtt").textContent = "Niet beschikbaar";
      }
    }

    // ==== CPU-TEST ====
    async function runCpuTest() {
      const out = document.getElementById("cpuResult");
      out.textContent = "Test bezigâ€¦";
      await new Promise(r => setTimeout(r, 50));

      const iterations = 5_000_000;
      const start = performance.now();
      let x = 0;
      for (let i = 0; i < iterations; i++) {
        x += Math.sqrt(i % 1000);
      }
      const ms = performance.now() - start;

      let score;
      if (ms < 300)      score = "âš¡ Zeer snel";
      else if (ms < 700)  score = "âœ… Prima";
      else if (ms < 1500) score = "âš ï¸ Langzamer systeem";
      else                score = "ðŸ¢ Erg traag of zwaar belast";

      out.innerHTML =
        `<p>${score}</p>` +
        `<p>Gemeten tijd: <strong>${ms.toFixed(0)} ms</strong> voor ${iterations.toLocaleString("nl-NL")} bewerkingen.</p>`;
    }

    // ==== NETWERKTEST ====
    async function runNetTest() {
      const statusEl = document.getElementById("netStatus");
      const resultEl = document.getElementById("netResult");

      statusEl.textContent = "Test bezigâ€¦";
      resultEl.textContent = "";

      const t0 = performance.now();
      try {
        const res = await fetch(TEST_FILE_URL + "?t=" + Date.now(), { cache: "no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);

        await res.arrayBuffer();
        const t1 = performance.now();

        const sec = (t1 - t0) / 1000;
        const mbit = (TEST_FILE_SIZE_BYTES * 8) / 1_000_000;
        const mbitps = mbit / sec;

        statusEl.textContent = "âœ… Klaar";
        resultEl.innerHTML =
          `<p>Geschatte downloadsnelheid: <strong>${mbitps.toFixed(2)} Mbit/s</strong></p>` +
          `<p>Totale downloadtijd: ${sec.toFixed(2)} s voor ~${(TEST_FILE_SIZE_BYTES / 1024).toFixed(0)} KB.</p>`;
      } catch (e) {
        statusEl.innerHTML = `<span class="error">Fout tijdens test: ${e.message}</span>`;
        resultEl.textContent = "";
      }
    }

    // ==== VERSTUREN NAAR SHEET ====
    function getText(id) {
      const el = document.getElementById(id);
      return el ? el.textContent.trim() : "";
    }

    async function sendResultsToSheet() {
      const statusEl = document.getElementById("sendStatus");
      statusEl.textContent = "Resultaten worden verzondenâ€¦";

      const payload = {
        os: getText("osInfo"),
        browser: getText("browserInfo"),
        lang: getText("langInfo"),
        cpu: getText("cpuInfo"),
        ram: getText("ramInfo"),
        screen: getText("screenInfo"),
        online: getText("onlineInfo"),
        connType: getText("connType"),
        connDownlink: getText("connDownlink"),
        connRtt: getText("connRtt"),
        cpuResult: document.getElementById("cpuResult")?.innerText.trim() || "",
        netResult: document.getElementById("netResult")?.innerText.trim() || ""
      };

      try {
        await fetch(SHEET_API_URL, {
          method: "POST",
          mode: "no-cors", // voorkomt CORS/preflight problemen met Apps Script
          headers: {
            "Content-Type": "text/plain;charset=utf-8"
          },
          body: JSON.stringify(payload)
        });

        // In no-cors kunnen we het antwoord niet lezen, dus we gaan uit van succes
        statusEl.innerHTML = "<strong>Verzonden (controleer de CW-sheet).</strong>";
      } catch (err) {
        statusEl.innerHTML = "<span class='error'>Fout bij verzenden: " + err.message + "</span>";
      }
    }

    // ==== INIT ====
    function init() {
      initSystemInfo();
      document.getElementById("cpuTestBtn").addEventListener("click", runCpuTest);
      document.getElementById("netTestBtn").addEventListener("click", runNetTest);
      document.getElementById("sendBtn").addEventListener("click", sendResultsToSheet);

      window.addEventListener("online",  () => document.getElementById("onlineInfo").textContent = "Online");
      window.addEventListener("offline", () => document.getElementById("onlineInfo").textContent = "Offline");
    }

    window.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
